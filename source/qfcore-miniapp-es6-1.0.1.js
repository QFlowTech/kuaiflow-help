var e={934:e=>{e.exports="1.0.1"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return(t=function(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(r,{Ay:()=>C,HF:()=>D,Ts:()=>j,j:()=>x,qP:()=>E,iD:()=>k,ri:()=>T,RI:()=>S});var c={"Content-Type":"application/json",Cookie:"qToken="},l=function(e){return new Promise((function(t,n){var r;if("undefined"!=typeof tt&&tt.request)r=tt.request;else if("undefined"!=typeof wx&&wx.request)r=wx.request;else if("undefined"!=typeof my&&my.request)r=my.request;else{if("undefined"==typeof swan||!swan.request)return void n(new Error("Unsupported mini-program environment"));r=swan.request}r(u(u({},e),{},{success:function(e){var r,o,i;401!==(null==e||null===(r=e.data)||void 0===r?void 0:r.code)?0===(null==e||null===(o=e.data)||void 0===o?void 0:o.status)?t(e):n(new Error(null==e||null===(i=e.data)||void 0===i?void 0:i.msg)):n(new Error("Unauthorized"))},fail:function(e){n(e)},complete:function(){}}))}))};const s=function(e){c.Cookie="qToken="+e},f=function(e,t,n){return l(u({url:e,method:"GET",data:t,header:c},n))},d=function(e,t,n){return l(u({url:e,method:"POST",data:t,header:c},n))};var p=n(934),v=n.n(p),y="http://beta.kuaiflow.com",m="http://localhost:3000",w="prod",b=!1,h="",g=null,q=null,O={},P=function(e){switch(w){case"prod":return"https://www.kuaiflow.com"+e;case"beta":return y+e;case"dev":return m+e;default:throw new Error("Invalid environment")}},j=function(e){return O.accessToken=e.accessToken,O.client=e.client,e.env&&(w=e.env),k()},k=function(){return O.accessToken?(e=O.accessToken,d(P("/qflow/auth/login"),null,{header:{qflowAccessToken:e}})).then((function(e){var t,n;if(!(h=(null==e||null===(t=e.header)||void 0===t?void 0:t.qToken)||(null==e||null===(n=e.header)||void 0===n?void 0:n.qtoken)))throw Error("Login failed");return b=!0,s(h),h})):new Promise((function(e,t){return t("accessToken not provided")}));var e},T=function(){return d(P("/qflow/user/logout")).then((function(e){return 0===e.data.status}))},S=function(){return b?f(P("/qflow/order/query/count"),{withCredentials:!0}).then((function(e){return e.data.data})):new Promise((function(e,t){return t("Not login")}))},E=function(e){g=e,!e&&q?(clearInterval(q),q=null):e&&!q&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e4;if(!b)throw new Error("Not logged in");var t=function(){(b?f(P("/qflow/order/query/todo_count"),{withCredentials:!0}).then((function(e){return e.data.data})):new Promise((function(e,t){return t("Not login")}))).then((function(e){g&&g(e)})).catch((function(e){console.error("Error fetching summary:",e)}))};t(),q=setInterval(t,e)}(6e4)},x=function(){return b},D=function(){return v()};const C={init:j,getVersion:D,isLogged:x,login:k,logout:T,querySummary:S,listenSummary:E};var I=r.Ay,A=r.HF,L=r.Ts,N=r.j,_=r.qP,F=r.iD,H=r.ri,R=r.RI;export{I as default,A as getVersion,L as init,N as isLogged,_ as listenSummary,F as login,H as logout,R as querySummary};