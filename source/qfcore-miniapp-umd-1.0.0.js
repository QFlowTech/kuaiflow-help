!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(()=>(()=>{var e={934:e=>{e.exports="1.0.0"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}n.r(r),n.d(r,{default:()=>E,getVersion:()=>x,init:()=>j,isLogged:()=>T,listenSummary:()=>k,login:()=>q,logout:()=>P,querySummary:()=>S});var u={"Content-Type":"application/json",Cookie:"qToken="},c=function(e){return new Promise((function(t,n){var r;if("undefined"!=typeof tt&&tt.request)r=tt.request;else if("undefined"!=typeof wx&&wx.request)r=wx.request;else if("undefined"!=typeof my&&my.request)r=my.request;else{if("undefined"==typeof swan||!swan.request)return void n(new Error("Unsupported mini-program environment"));r=swan.request}r(o(o({},e),{},{success:function(e){var r,o,i;401!==(null==e||null===(r=e.data)||void 0===r?void 0:r.code)?0===(null==e||null===(o=e.data)||void 0===o?void 0:o.status)?t(e):n(new Error(null==e||null===(i=e.data)||void 0===i?void 0:i.msg)):n(new Error("Unauthorized"))},fail:function(e){n(e)},complete:function(){}}))}))};const a=function(e){u.Cookie="qToken="+e},l=function(e,t,n){return c(o({url:e,method:"GET",data:t,header:u},n))},f=function(e,t,n){return c(o({url:e,method:"POST",data:t,header:u},n))};var s=n(934),d=n.n(s),p="http://beta.kuaiflow.com",y="http://localhost:3000",m="prod",v=!1,b="",w=null,g=null,h={},O=function(e){switch(m){case"prod":return"https://www.kuaiflow.com"+e;case"beta":return p+e;case"dev":return y+e;default:throw new Error("Invalid environment")}},j=function(e){return h.accessToken=e.accessToken,h.client=e.client,e.env&&(m=e.env),q()},q=function(){return h.accessToken?(e=h.accessToken,f(O("/qflow/auth/login"),null,{header:{qflowAccessToken:e}})).then((function(e){var t;if(!(b=null==e||null===(t=e.header)||void 0===t?void 0:t.qtoken))throw Error("Login failed");return v=!0,a(b),b})):new Promise((function(e,t){return t("accessToken not provided")}));var e},P=function(){return f(O("/qflow/user/logout")).then((function(e){return 0===e.data.status}))},S=function(){return v?l(O("/qflow/order/query/count"),{withCredentials:!0}).then((function(e){return e.data.data})):new Promise((function(e,t){return t("Not login")}))},k=function(e){w=e,!e&&g?(clearInterval(g),g=null):e&&!g&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e4;if(!v)throw new Error("Not logged in");var t=function(){(v?l(O("/qflow/order/query/todo_count"),{withCredentials:!0}).then((function(e){return e.data.data})):new Promise((function(e,t){return t("Not login")}))).then((function(e){w&&w(e)})).catch((function(e){console.error("Error fetching summary:",e)}))};t(),g=setInterval(t,e)}(6e4)},T=function(){return v},x=function(){return d()};const E={init:j,getVersion:x,isLogged:T,login:q,logout:P,querySummary:S,listenSummary:k}})(),r})()));